# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:
notify:
  - name: everyone
    platform: group
    services:
      - service: mobile_app_samsung
      - service: mobile_app_nokia_7_2
climate:
  - platform: generic_thermostat
    name: Attic climate
    heater: switch.heater
    target_sensor: sensor.attic_thermometer
    target_temp: 20
    initial_hvac_mode: "off"
  - platform: generic_thermostat
    name: Guestroom climate
    heater: switch.heater
    target_sensor: sensor.guestroom_thermometer
    target_temp: 20
    initial_hvac_mode: "off"
  - platform: generic_thermostat
    name: Bathroom climate
    heater: switch.heater
    target_sensor: sensor.bathroom_thermometer
    target_temp: 20
    initial_hvac_mode: "off"
  - platform: generic_thermostat
    name: Bedroom climate
    heater: switch.heater
    target_sensor: sensor.bedroom_thermometer
    target_temp: 20
    initial_hvac_mode: "off"
influxdb:
  host: a0d7b954-influxdb
  port: 8086
  database: homeassistant
  username: homeassistant
  password: !secret influxdb_password
  max_retries: 3
  measurement_attr: entity_id
  exclude:
    domains:
      - automation
      - persistent_notification
homeassistant:
  allowlist_external_dirs:
    - "/config/"
  auth_providers:
    - type: homeassistant
    - type: trusted_networks
      trusted_networks:
        - 192.168.1.0/25
http:
  trusted_proxies:
    - 192.168.1.252
  use_x_forwarded_for: true
  ip_ban_enabled: true
  login_attempts_threshold: 3
recorder:
  purge_keep_days: 800
sensor:
  - platform: filesize
    file_paths:
      - /config/home-assistant_v2.db
  - platform: mold_indicator
    name: bedroom_mold
    indoor_temp_sensor: sensor.bedroom_thermometer
    indoor_humidity_sensor: sensor.bedroom_humidity
    outdoor_temp_sensor: sensor.outside_temperature
    calibration_factor: 1.6
  - platform: mold_indicator
    indoor_temp_sensor: sensor.attic_thermometer
    indoor_humidity_sensor: sensor.attic_humidity
    outdoor_temp_sensor: sensor.outside_temperature
    calibration_factor: 1.5
    name: attic_mold
  - platform: mold_indicator
    indoor_temp_sensor: sensor.bathroom_thermometer
    indoor_humidity_sensor: sensor.bathroom_humidity
    outdoor_temp_sensor: sensor.outside_temperature
    calibration_factor: 1.5
    name: bathroom_mold
  - platform: mold_indicator
    indoor_temp_sensor: sensor.guestroom_thermometer
    indoor_humidity_sensor: sensor.guestroom_humidity
    outdoor_temp_sensor: sensor.outside_temperature
    calibration_factor: 1.6
    name: guestroom_mold
  - platform: mold_indicator
    indoor_temp_sensor: sensor.shed_thermometer
    indoor_humidity_sensor: sensor.shed_humidity
    outdoor_temp_sensor: sensor.outside_temperature
    calibration_factor: 1.0
    name: shed_mold
  - platform: mold_indicator
    indoor_temp_sensor: sensor.lounge_thermometer
    indoor_humidity_sensor: sensor.lounge_humidity
    outdoor_temp_sensor: sensor.outside_temperature
    calibration_factor: 1.8
    name: lounge_mold
  - platform: systemmonitor
    resources:
      - type: disk_free
        arg: /home
      - type: memory_use_percent
      - type: processor_use
      - type: last_boot
  - platform: command_line
    command: python3 -c "import requests; import json; import random; dataRequest = requests.get('https://cdn-secure.buienalarm.nl/api/3.4/forecast.php?lat=52.095&lon=5.103&region=nl&unit=mm%2Fu&c='+str(random.randint(0,999999999999999)) ).text; dataRequest = dataRequest.replace('\r\n',' '); data = '{\"data\":'+dataRequest+'}';    print(data);"
    name: Neerslag_Buienalarm_Regen_Data
    json_attributes:
      - data
    value_template: "last_changed: {{states.sensor.neerslag_buienalarm_regen_data.last_changed | default(now())}}"
    scan_interval: 240
template:
  - sensor:
      - name: outside temperature
        unit_of_measurement: "Â°C"
        state: "{{ state_attr('weather.home', 'temperature')}}"
        device_class: temperature
      - name: outside humidity
        unit_of_measurement: "%"
        state: "{{ state_attr('weather.home', 'humidity')}}"
        device_class: humidity
      - name: outside airpressure
        unit_of_measurement: "hPa"
        state: "{{ state_attr('weather.home', 'pressure')}}"
        device_class: humidity
      - name: Expected production today
        unit_of_measurement: "kWh"
        state: "{{ states('sensor.energy_production_today_1') | float + states('sensor.energy_production_today_2') | float }}"
        device_class: energy
      - name: Expected production current hour
        unit_of_measurement: "kWh"
        state: "{{ states('sensor.energy_current_hour_1') | float + states('sensor.energy_current_hour_2') | float }}"
        device_class: energy
      - name: Expected production next hour
        unit_of_measurement: "kWh"
        state: "{{ states('sensor.energy_next_hour_1') | float + states('sensor.energy_next_hour_2') | float }}"
        device_class: energy
      - name: Current power consumption
        unit_of_measurement: "W"
        state: "{{ states('sensor.power_from_grid') | float + states('sensor.growatt_total_output_power') | float }}"
        device_class: power
shell_command:
  backup_logs: cp /config/home-assistant.log /config/home-assistant.log.bk
tts:
  - platform: google_translate

script: !include scripts.yaml
automation: !include automations.yaml
