plant:
  openplantbook:
    client_id: !secret plantbook_client_id
    secret: !secret plantbook_secret

  flower:
    species: citrus limon
    image: openplantbook
    sensors:
      moisture: sensor.flower_moisture
      temperature: sensor.flower_temperature
      conductivity: sensor.flower_soil_conductivity
      brightness: sensor.flower_illuminance
    warn_low_brightness: false

alert:
  plant:
    name: Plant
    entity_id: plant.flower
    state: problem
    skip_first: true
    repeat:
      - 1
      - 480
    message: "Plant: {{ state_attr('plant.flower', 'problem') }}"
    notifiers:
      - pushnotification
      - mobile_app_sm_a520f
      - mobile_app_nokia_7_2
    data:
      clickAction: lovelace/plant
      channel: plant
      tag: plant
      requireInteraction: true
      url: lovelace/plant
      actions:
        - action: plant_ignore
          title: ðŸ”• Ignore ðŸª´
          icon: mdi:alert-remove

automation:
  - alias: "Plant acknowledged"
    trigger:
      - platform: event
        event_type:
          - html5_notification.clicked
          - mobile_app_notification_action
        event_data:
          action: plant_ignore
    action:
      - service: alert.turn_off
        target:
          entity_id: alert.plant
      - service: notify.mobile_app_nokia_7_2
        data:
          message: clear_notification
          data:
            tag: plant
      - service: html5.dismiss
        data:
          data:
            tag: plant
