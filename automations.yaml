- id: '1603830622083'
  alias: Hall and corridor light
  description: Triggers when there is movement in the hall at ground level or first
    floor. When it freezes, warn with a blue light. Brightness is adapted to the desired
    level. Because the IKEA sensor at the corridor is slow in going to the cleared
    state, have a 10m wait before the Philips sensor at the hall is allowed to clear.
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.hall_motion
    - binary_sensor.corridor_motion
    - binary_sensor.front_door
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dark
    state: 'on'
  action:
  - service: light.turn_on
    data:
      brightness_pct: '{% if (now().hour|int >= 22) or (now().hour|int <= 6) %} 1
        {% else %} 100 {% endif %}'
      color_temp: '{% if (now().hour|int >= 22) or (now().hour|int <= 6) %} 454 {%
        else %} 366 {% endif %}'
    target:
      entity_id:
      - light.corridor
      - light.hall
  - wait_template: '  {{ (states(''binary_sensor.hall_motion'') == ''off'') and (states(''binary_sensor.corridor_motion'')
      == ''off'') }}'
    continue_on_timeout: true
    timeout: 01:00:00
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    target:
      entity_id:
      - light.corridor
      - light.hall
    data: {}
  mode: queued
  max: 5
- id: '1603831020194'
  alias: Kitchen light
  description: Triggers when there is movement in the kitchen. Only activate light
    when there is less than 20 lux measured in the hall at ground level. Brightness
    is adapted to the desired level.
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.kitchen_motion
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dark
    state: 'on'
  action:
  - service: light.turn_on
    data:
      brightness_pct: '{% if (now().hour|int >= 22) or (now().hour|int <= 7) %} 1
        {% else %} 100 {% endif %}'
      color_temp: '{% if (now().hour|int >= 22) or (now().hour|int <= 7) %} 454 {%
        else %} 366 {% endif %}'
    target:
      entity_id: light.kitchen
  - wait_for_trigger:
    - platform: state
      entity_id:
      - binary_sensor.kitchen_motion
      to: 'off'
      for:
        hours: 0
        minutes: 2
        seconds: 0
    timeout:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id: light.kitchen
  mode: single
- id: '1608134139962'
  alias: 'Shed door opened '
  description: Put the light in the shed on when the door is opened and it is dark.
    Put it off when the door is closed for longer than two minutes. If the door is
    closed, the user is reminded of this automation by a brief flash.
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.shed_door
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dark
    state: 'on'
  action:
  - service: light.turn_on
    data: {}
    target:
      entity_id: light.shed
  - wait_for_trigger:
    - platform: state
      entity_id:
      - binary_sensor.shed_door
      to: 'off'
    timeout:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id: light.shed
  mode: restart
- id: '1609974870568'
  alias: Doorbell
  description: Flash lights and notify when the doorbell is detected by the RTL_433
    extension.
  trigger:
  - platform: device
    domain: mqtt
    device_id: 83b12a930eaf4c7cb659f87de06f7708
    type: button_short_release
    subtype: button_1
    discovery_id: Proove-Security-3-30755554 Proove-Security-3-30755554-CH
  condition: []
  action:
  - device_id: c0f2abd8a92c0bfad616ec4aa371901d
    domain: mobile_app
    type: notify
    message: Doorbell!
  - service: light.toggle
    data:
      flash: long
    target:
      area_id:
      - kitchen
      - hall
      - corridor
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - service: light.toggle
    data:
      flash: long
    target:
      area_id:
      - kitchen
      - hall
      - corridor
  mode: single
- id: '1612988672846'
  alias: Toilet light
  description: Switch the toilet light when the door is opened.
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.toilet_door
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    data: {}
    target:
      entity_id: light.toilet
  - wait_for_trigger:
    - platform: state
      entity_id:
      - binary_sensor.toilet_door
      to: 'on'
    timeout:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id: light.toilet
  mode: single
- id: '1612988850571'
  alias: Pantry light
  description: Switch the light in the pantry when the door is opened or closed.
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.pantry_door
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    entity_id: light.pantry
  - wait_for_trigger:
    - platform: state
      entity_id:
      - binary_sensor.pantry_door
      to: 'off'
    timeout:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    entity_id: light.pantry
  mode: single
- id: '1614112596198'
  alias: Bike motion
  description: When it is dark and there is motion, put on the lights in the bike
    shed. Else, put off. Note that this automation can be turned off by  automation.bike_button.
  trigger:
  - platform: state
    entity_id: binary_sensor.bike_motion
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.dark
    state: 'on'
  action:
  - service: light.turn_on
    data: {}
    target:
      entity_id: light.bike
  - wait_for_trigger:
    - platform: state
      entity_id:
      - binary_sensor.bike_motion
      to: 'off'
    timeout:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id: light.bike
  mode: single
- id: '1652901588502'
  alias: Vacuum charged
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: vacuum.vacuum
    attribute: battery_level
    above: '99'
  condition: []
  action:
  - device_id: c0f2abd8a92c0bfad616ec4aa371901d
    domain: mobile_app
    type: notify
    message: Vacuum charged
  mode: single
- id: '1662921513914'
  alias: Walk in closet
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.walk_in_closet_door
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    data: {}
    target:
      entity_id: light.walk_in_closet
  - wait_for_trigger:
    - platform: state
      entity_id:
      - binary_sensor.walk_in_closet_door
      to: 'off'
    continue_on_timeout: true
    timeout:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id: light.walk_in_closet
  mode: single
- id: '1663095761773'
  alias: Terrace
  description: ''
  use_blueprint:
    path: EPMatt/philips_324131092621.yaml
    input:
      integration: ZHA
      controller_device: d2d1de274ba99aa61fa79c7b3f8e64c1
      action_button_on_short:
      - service: light.turn_on
        data: {}
        target:
          entity_id: light.terrace
      action_button_off_short:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.terrace
      action_button_on_long:
      - service: automation.turn_on
        data: {}
        target:
          entity_id: automation.hall_corridor_light
      action_button_off_long:
      - service: automation.turn_off
        data: {}
        target:
          entity_id: automation.hall_corridor_light
      action_button_up_short:
      - device_id: a9f1fc5ca682b5534d1e91820b492b08
        domain: light
        entity_id: light.terrace
        type: brightness_increase
      action_button_down_short:
      - device_id: a9f1fc5ca682b5534d1e91820b492b08
        domain: light
        entity_id: light.terrace
        type: brightness_decrease
      action_button_up_long: []
- id: '1667116701161'
  alias: Bathroom light
  description: Put light on when door is opened. Put off when closed for 10 minutes.
    Put off when nothing has changed for 30 minutes, except when showering.
  trigger:
  - platform: state
    entity_id: binary_sensor.bathroom_door
    to: 'off'
    for: 00:15:00
    id: door long closed
  - platform: state
    entity_id: binary_sensor.bathroom_door
    to: 'on'
    id: door opened
  - platform: state
    entity_id: binary_sensor.bathroom_door
    to: 'on'
    for: 00:10:00
    id: door long opened
  - platform: numeric_state
    entity_id: sensor.bathroom_humidity
    below: '80'
    for: 00:00:05
    id: low humidity
  condition: []
  action:
  - choose:
    - alias: Presumed forgotten to switch light off while door open
      conditions:
      - condition: trigger
        id: door long opened
      sequence:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.bathroom
      - service: input_boolean.turn_off
        entity_id: input_boolean.shower
    - alias: Presumed showering
      conditions:
      - condition: trigger
        id: door long closed
      - condition: numeric_state
        entity_id: sensor.bathroom_humidity
        above: '90'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.shower
      - service: light.toggle
        entity_id: light.bathroom
      - delay: 00:00:01
      - service: light.toggle
        data: {}
        target:
          entity_id: light.bathroom
      - wait_for_trigger:
        - platform: numeric_state
          entity_id: sensor.bathroom_humidity
          below: '90'
        timeout:
          hours: 0
          minutes: 30
          seconds: 0
          milliseconds: 0
      - service: input_boolean.turn_off
        entity_id: input_boolean.shower
    - alias: Presumed forgotten to switch light off while door closed
      conditions:
      - condition: trigger
        id: door long closed
      sequence:
      - service: input_boolean.turn_off
        entity_id: input_boolean.shower
      - service: light.turn_off
        entity_id: light.bathroom
    - alias: Door opened
      conditions:
      - condition: trigger
        id: door opened
      sequence:
      - service: input_boolean.turn_off
        entity_id: input_boolean.shower
      - service: light.turn_on
        entity_id: light.bathroom
  mode: single
- id: '1672605032341'
  alias: Notify
  description: ''
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.voltage
    above: 0
    below: 207
  - platform: numeric_state
    entity_id:
    - sensor.voltage
    above: 252
  - platform: state
    entity_id:
    - sensor.shed_frostrisk
    from: no_risk
    alias: Shed freezing
  - platform: numeric_state
    entity_id:
    - sensor.attic_temperature
    - sensor.bathroom_temperature
    - sensor.bedroom_temperature
    - sensor.guestroom_temperature
    - sensor.lounge_temperature
    - sensor.shed_temperature
    below: 0
    alias: Thermometer below 0
  - platform: numeric_state
    entity_id:
    - sensor.attic_temperature
    - sensor.bathroom_temperature
    - sensor.bedroom_temperature
    - sensor.guestroom_temperature
    - sensor.lounge_temperature
    - sensor.shed_temperature
    above: 45
    alias: Thermometer above 40
  - platform: state
    entity_id:
    - binary_sensor.bathroom_light_overpowering
    - binary_sensor.bike_light_overpowering
    - binary_sensor.bike_socket_overpowering
    - binary_sensor.desk_north_overpowering
    - binary_sensor.dishwasher_overpowering
    - binary_sensor.dryer_overpowering
    - binary_sensor.energy_meter_overpowering
    - binary_sensor.fan_overpowering
    - binary_sensor.fridge_kitchen_overpowering
    - binary_sensor.server_plug_overpowering
    - binary_sensor.terrace_overpowering
    - binary_sensor.toilet_overpowering
    - binary_sensor.washing_machine_overpowering
    to: 'on'
    alias: Overpowering
  - platform: state
    entity_id:
    - binary_sensor.bathroom_light_overheating
    - binary_sensor.bike_overheating
    - binary_sensor.desk_north_overheating
    - binary_sensor.dishwasher_overheating
    - binary_sensor.dryer_overheating
    - binary_sensor.fan_overheating
    - binary_sensor.fridge_kitchen_overheating
    - binary_sensor.server_plug_overheating
    - binary_sensor.toilet_overheating
    - binary_sensor.washing_machine_overheating
    to: 'on'
    alias: Overheating
  - platform: numeric_state
    entity_id: sensor.washing_machine_flood_battery
    below: 20
  - platform: state
    entity_id: binary_sensor.washing_machine_flood
    to: 'on'
    id: flood
  - platform: state
    entity_id:
    - sensor.experiabox_v10_external_ip
    alias: Changed Archer IP address
  - platform: state
    entity_id:
    - sensor.myip
    alias: Changed external IP address
  - platform: state
    entity_id:
    - fan.fan
    alias: Fan unavailable
    to: unavailable
  - type: unsafe
    platform: device
    device_id: 953c91864067f38764af450c5f41be7c
    entity_id: d22b961e536ec094696c518cc29bc458
    domain: binary_sensor
  - platform: state
    entity_id:
    - binary_sensor.nieuw_engeland_nas_drive_1_below_min_remaining_life
    - binary_sensor.nieuw_engeland_nas_drive_1_exceeded_max_bad_sectors
    - binary_sensor.nieuw_engeland_nas_drive_2_below_min_remaining_life
    - binary_sensor.nieuw_engeland_nas_drive_2_exceeded_max_bad_sectors
    to: 'on'
    alias: Drive problems
  condition: []
  action:
  - device_id: c0f2abd8a92c0bfad616ec4aa371901d
    domain: mobile_app
    type: notify
    title: Problem with {{ trigger.entity_id }}
    message: Triggered on {{ trigger.entity_id }} from {{ trigger.from_state.state
      }} to state {{ trigger.to_state.state }} at {{ now() }}.
  mode: single
- id: '1672607309301'
  alias: Desk
  description: Handling events from the buttons on the desks.
  trigger:
  - id: south_on
    device_id: f2920d964a5c507e42ff8757a220ddb8
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
  - id: south_off
    device_id: f2920d964a5c507e42ff8757a220ddb8
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_off
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: south_on
      sequence:
      - service: switch.turn_on
        entity_id: switch.desk_south
    - conditions:
      - condition: trigger
        id: south_off
      sequence:
      - service: switch.turn_off
        target:
          entity_id: switch.desk_south
        data: {}
  mode: single
- id: '1675062799052'
  alias: Train alert
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.utrecht_alkmaar
  condition: []
  action:
  - device_id: c0f2abd8a92c0bfad616ec4aa371901d
    domain: mobile_app
    type: notify
    message: Train trigger
  mode: single
- id: '1678268586740'
  alias: Vacuum single room
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_button.vacuum_single
    alias: When vacuum single button pressed
  condition: []
  action:
  - service: select.select_option
    data:
      option: single
    target:
      entity_id: select.vacuum_mode
    alias: Vacuum clean single room
  - wait_for_trigger:
    - platform: state
      entity_id:
      - vacuum.vacuum
      to: idle
    timeout:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
    continue_on_timeout: false
  - device_id: c0f2abd8a92c0bfad616ec4aa371901d
    domain: mobile_app
    type: notify
    message: Vacuum cleaner is done
  mode: single
- id: '1692770404361'
  alias: Dishwasher ready
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.dishwasher_power
    for:
      hours: 0
      minutes: 10
      seconds: 0
    below: 5
  condition: []
  action:
  - device_id: c0f2abd8a92c0bfad616ec4aa371901d
    domain: mobile_app
    type: notify
    message: Dishwasher is ready
  mode: single
- id: '1693129416861'
  alias: Fan turn off
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.bathroom_humidity
    for:
      hours: 0
      minutes: 5
      seconds: 0
    below: 75
  - platform: numeric_state
    entity_id: sensor.bathroom_differential_dew_point
    below: 2
  condition:
  - condition: device
    device_id: a9c1ea637f003a57f1abb222312e4d02
    domain: fan
    entity_id: 4dc9a6cc91fe6a9e15b04d6f0acccfa2
    type: is_on
  action:
  - service: fan.turn_off
    data: {}
    target:
      entity_id: fan.fan
  - device_id: c0f2abd8a92c0bfad616ec4aa371901d
    domain: mobile_app
    type: notify
    message: Triggered by {{ trigger.entity_id }}, being {{ trigger.to_state }}.
  mode: single
- id: '1693418071300'
  alias: Fan turn on
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.bathroom_differential_dew_point
    above: 2.5
  condition:
  - condition: state
    entity_id: fan.fan
    state: 'off'
  action:
  - service: fan.turn_on
    data: {}
    target:
      entity_id: fan.fan
  mode: single
- id: '1693470796463'
  alias: Washing machine is ready
  description: ''
  trigger:
  - type: not_running
    platform: device
    device_id: 7b748ddf488252dc1ed824f226b39955
    entity_id: 917e85b275361e10b477a358351e103b
    domain: binary_sensor
  condition: []
  action:
  - device_id: c0f2abd8a92c0bfad616ec4aa371901d
    domain: mobile_app
    type: notify
    message: Washing machine is ready
  mode: single
- id: '1697474001246'
  alias: Desk north automation
  description: ''
  trigger:
  - device_id: edc737eaf70410f77edc47501e93b308
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
    id: turn_on
  - device_id: edc737eaf70410f77edc47501e93b308
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_off
    id: turn_off
  condition: []
  action:
  - if:
    - condition: trigger
      id:
      - turn_on
    then:
    - type: turn_on
      device_id: 36543f490d13ca02e682f5623788a79b
      entity_id: ab46a26638e7ab4314922daaada9644a
      domain: switch
    else:
    - type: turn_off
      device_id: 36543f490d13ca02e682f5623788a79b
      entity_id: ab46a26638e7ab4314922daaada9644a
      domain: switch
  mode: single
- id: '1699101063603'
  alias: Fan button
  description: ''
  trigger:
  - device_id: dba399be5f18d6a874165e6f8f4cf9c5
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
    id: turn_on
  - device_id: dba399be5f18d6a874165e6f8f4cf9c5
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_off
    id: turn_off
  condition: []
  action:
  - if:
    - condition: trigger
      id:
      - turn_on
    then:
    - service: fan.turn_on
      data: {}
      target:
        entity_id: fan.fan
    else:
    - service: fan.turn_off
      data: {}
      target:
        entity_id: fan.fan
  mode: single
- id: '1699803193333'
  alias: Bedroom remote
  description: ''
  trigger:
  - device_id: 5a9933c449a2a8068f6012de36a6e91d
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
    id: '1'
  - device_id: 5a9933c449a2a8068f6012de36a6e91d
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: dim_up
    id: '2'
  - device_id: 5a9933c449a2a8068f6012de36a6e91d
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: dim_down
    id: '3'
  - device_id: 5a9933c449a2a8068f6012de36a6e91d
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: left
    id: '4'
  - device_id: 5a9933c449a2a8068f6012de36a6e91d
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: right
    id: '5'
  - device_id: 5a9933c449a2a8068f6012de36a6e91d
    domain: zha
    platform: device
    type: remote_button_long_press
    subtype: left
    id: '6'
  - device_id: 5a9933c449a2a8068f6012de36a6e91d
    domain: zha
    platform: device
    type: remote_button_long_press
    subtype: right
    id: '7'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - '1'
      sequence:
      - service: light.toggle
        data: {}
        target:
          entity_id: light.bedroom
    - conditions:
      - condition: trigger
        id:
        - '2'
      sequence:
      - service: light.turn_on
        data:
          brightness_step: 10
        target:
          entity_id: light.bedroom
    - conditions:
      - condition: trigger
        id:
        - '3'
      sequence:
      - service: light.turn_on
        data:
          brightness_step: -10
        target:
          entity_id: light.bedroom
    - conditions:
      - condition: trigger
        id:
        - '4'
      sequence:
      - type: toggle
        device_id: 6783c5c5d415efc8d8ee992bcede1f16
        entity_id: c0713d089c995a6583b6ea2ca85d3848
        domain: light
    - conditions:
      - condition: trigger
        id:
        - '5'
      sequence:
      - type: toggle
        device_id: a86d85dac77c6830cc859999c74e41da
        entity_id: 7b92662312ab2bfa93a704d11b8f5b1b
        domain: light
  mode: single
